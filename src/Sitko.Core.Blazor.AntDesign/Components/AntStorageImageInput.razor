@inherits BaseAntStoragePictureInput<Sitko.Core.Storage.StorageItem?>
<AntDesign.Spin Spinning="IsSpinning">
    <div class="ant-upload-list ant-upload-list-picture-card ant-upload-list-@Size">
        @if (Image is not null)
        {
            <div Class="ant-upload-list-picture-card-container">

                <div class="ant-upload-list-item ant-upload-list-item-done  ant-upload-list-item-list-type-picture-card">
                    <div class="ant-upload-list-item-info">
                        <span class="ant-upload-span">
                            @{
                                <a class="ant-upload-list-item-thumbnail" href="@Image.Url" target="_blank" rel="noopener noreferrer">
                                    <img src="@Image.SmallPreviewUrl" alt="@Image.StorageItem.FileName" class="ant-upload-list-item-image"/>
                                </a>
                            }
                            <a target="_blank" rel="noopener noreferrer" class="ant-upload-list-item-name" title="@Image.StorageItem.FileName" href="@Image.Url">@Image.StorageItem.FileName</a>
                        </span>
                    </div>

                    <span class="ant-upload-list-item-actions">
                        <a target="_blank" rel="noopener noreferrer" title="@PreviewText" @onclick="() => PreviewFile(Image)">
                            <AntDesign.Icon Type="eye"/>
                        </a>
                        <button title="@RemoveText" type="button" class="ant-btn ant-btn-text ant-btn-sm ant-btn-icon-only ant-upload-list-item-card-actions-btn" @onclick="() => RemoveFile(Image)">
                            <AntDesign.Icon Type="delete"/>
                        </button>
                    </span>
                </div>
            </div>
        }
        else
        {
            <CascadingValue Value="this" IsFixed="true">
                <AntStorageItemInput
                    @ref="FileInput"
                    Storage="@Storage"
                    MaxFileSize="MaxFileSize"
                    MaxAllowedFiles="1"
                    ContentTypes="@ContentTypes"
                    ListType="picture-card"
                    GenerateMetadata="@((request, stream) => GenerateMetadataAsync(request, stream))"
                    @bind-Value="CurrentValue"
                    UploadPath="@UploadPath"
                    OnChange="@OnChangeAsync">
                    <div>
                        <AntDesign.Icon Spin="IsSpinning" Type="@(IsSpinning ? "Loading" : "plus")"></AntDesign.Icon>
                        <div className="ant-upload-text">@UploadText</div>
                    </div>
                </AntStorageItemInput>
            </CascadingValue>
        }
        <AntDesign.Modal Visible="PreviewVisible"
                         Title="@PreviewTitle"
                         Footer="null" OnCancel="@(() => PreviewVisible = false)">
            <img style="width: 100%" src="@ImgUrl" alt="@PreviewTitle"/>
        </AntDesign.Modal>
    </div>
</AntDesign.Spin>
