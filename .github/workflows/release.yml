name: Release

on:
    release:
        types:
            - created

jobs:
    build:
        runs-on: ubuntu-latest
        container: mcr.microsoft.com/dotnet/core/sdk:3.1
        env:
            APP_VERSION: ${{ github.event.release.tag_name }}
        steps:
            -   uses: actions/checkout@v2
            -   name: Restore
                run: dotnet restore --locked-mode
            -   name: Create packages
                run: dotnet pack --no-restore -c Release /p:Version=$APP_VERSION -o $(pwd)/packages
            -   name: Push to Nuget
                run: find $(pwd)/packages -name *.nupkg -exec dotnet nuget push {} -s https://api.nuget.org/v3/index.json -k ${{ secrets.NUGET_API_KEY }} \;
